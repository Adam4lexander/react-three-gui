"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var n=require("react"),t=e(n),r=require("react-three-fiber"),o=e(require("styled-components")),i=require("@react-spring/web"),a=require("react-use-gesture"),l=e(require("react-use-measure")),c=require("three"),u=require("react-color"),s=require("@react-spring/three");function d(){return(d=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function p(e,n){return n||(n=e.slice(0)),e.raw=n,e}var f=n.createContext({values:{current:new Map},gui:{current:new Map},state:{current:new Map},controls:[],addControl:function(e){return e},removeControl:function(){}});function b(e){return function(n){var r=n.children,o=function(e,n){if(null==e)return{};var t,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n.indexOf(t=i[r])>=0||(o[t]=e[t]);return o}(n,["children"]);return t.createElement(f.Consumer,null,(function(n){return t.createElement(e,Object.assign({},o),t.createElement(f.Provider,{value:n},r))}))}}var x,m=b(r.Canvas);(x=exports.ControlType||(exports.ControlType={})).NUMBER="number",x.STRING="string",x.BUTTON="button",x.BOOLEAN="boolean",x.SELECT="select",x.COLOR="color",x.XYPAD="xypad",x.FILE="file",x.CUSTOM="custom";var g,v,h,y,E={type:exports.ControlType.NUMBER,value:0},k=function(e,n,t){return void 0!==t?Math.min(Math.max(e,n),t):Math.min(e,n)},T=function(e,n,t,r,o){return(e-n)*(o-r)/(t-n)+r};function w(e,t){var r=n.useState((function(){try{var n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch(e){return console.log(e),t}})),o=r[0],i=r[1];return[o,function(n){try{var t=n instanceof Function?n(o):n;i(t),window.localStorage.setItem(e,JSON.stringify(t))}catch(e){console.log(e)}}]}var C,O=o.div(g||(g=p(["\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  padding: 8px 0;\n"]))),L=o.label(v||(v=p(["\n  display: flex;\n  font-family: sans-serif;\n  font-size: 14px;\n  color: rgba(0, 0, 0, 0.4);\n  width: 56px;\n  user-select: none;\n  ","\n"])),(function(e){return!0===e.flexLabel?"flex: 1;":""})),R=o.div(h||(h=p(["\n  display: flex;\n  ","\n  justify-content: flex-end;\n  padding: 0 8px;\n"])),(function(e){return!0!==e.flexLabel?"flex: 1;":""})),P=o.div(y||(y=p(["\n  display: flex;\n  font-family: sans-serif;\n  white-space: nowrap;\n  font-size: 14px;\n  color: rgba(0, 0, 0, 0.75);\n  justify-content: flex-end;\n  ","\n  ","\n"])),(function(e){return e.stack?"flex: 1;":""}),(function(e){return e.stack?"":"width: 42px;"}));function _(e){var n=e.htmlFor,r=e.label,o=e.flexLabel,i=e.value,a=e.children;return e.stack?t.createElement("div",null,t.createElement(O,null,t.createElement(L,{flexLabel:o},r),t.createElement(P,{stack:!0,flexLabel:o},i)),a):t.createElement(O,null,t.createElement(L,{flexLabel:o,htmlFor:n},r),t.createElement(R,{flexLabel:o},a),void 0!==i&&t.createElement(P,null,i))}var S,F,M,I,B,U,G,A,j,N,H,D,V,q,z,X,Y,J=o.input(C||(C=p(["\n  -webkit-appearance: none;\n  width: 100%;\n  background: transparent;\n  display: inline-block;\n\n  &:focus {\n    outline: none;\n  }\n\n  &::-webkit-slider-runnable-track {\n    width: 100%;\n    height: 12px;\n    cursor: pointer;\n    background: rgba(0, 0, 0, 0.045);\n    border-radius: 10px;\n  }\n\n  &::-webkit-slider-thumb {\n    border: none;\n    height: 20px;\n    width: 20px;\n    border-radius: 50%;\n    background: #ffffff;\n    cursor: pointer;\n    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.22);\n    -webkit-appearance: none;\n    margin-top: -4px;\n  }\n\n  &:focus::-webkit-slider-runnable-track {\n    outline: none;\n  }\n"]))),W=o.label(S||(S=p(["\n  height: 16px;\n  width: 16px;\n  border: 2px solid rgba(0, 0, 0, 0.065);\n  border-radius: 4px;\n  position: relative;\n  margin-top: -1px;\n  transition: ease-in-out 125ms;\n  transition-property: background-color, border-color;\n"]))),K=o.input(F||(F=p(["\n  opacity: 0;\n  margin-right: -15px;\n  & + ",':after {\n    position: absolute;\n    content: "";\n    display: inline-block;\n    height: 4px;\n    width: 8px;\n    border-left: 2px solid;\n    border-bottom: 2px solid;\n    left: 3px;\n    top: 4px;\n    opacity: 0;\n    transform: translate(0px, 2px) rotate(-45deg);\n    transition: ease-in-out 125ms;\n    transition-property: opacity, transform;\n  }\n  &:checked + ',":after {\n    opacity: 1;\n    transform: translate(0px, 0px) rotate(-45deg);\n  }\n  &:checked + "," {\n    background: rgba(0, 0, 0, 0.045);\n    border-color: rgba(0, 0, 0, 0.085);\n  }\n"])),W,W,W),Q=o.button(M||(M=p(["\n  display: block;\n\n  font-family: sans-serif;\n  font-size: 14px;\n  color: rgba(0, 0, 0, 0.4);\n\n  display: block;\n  position: relative;\n\n  width: 100%;\n  height: 32px;\n\n  color: #000;\n\n  border: 0;\n  background-color: rgba(0, 0, 0, 0.045);\n  border-radius: 4px;\n  padding: 0 4px;\n"]))),Z=o.div(I||(I=p(["\n  position: relative;\n\n  > div {\n    box-sizing: border-box !important;\n  }\n"]))),$=o.div(B||(B=p(["\n  width: 32px;\n  height: 16px;\n  border: 2px solid white;\n  box-shadow: 0 0 1px 0 rgba(0, 0, 0, 0.3);\n  cursor: pointer;\n"]))),ee=o.div(U||(U=p(["\n  position: absolute;\n  top: 24px;\n  right: 0px;\n  z-index: 100;\n"]))),ne=o.select(G||(G=p(["\n  display: block;\n\n  font-family: sans-serif;\n  font-size: 14px;\n  color: rgba(0, 0, 0, 0.4);\n\n  display: block;\n  position: relative;\n\n  width: 100%;\n  height: 32px;\n\n  color: #000;\n\n  margin-left: 8px;\n\n  border: 0;\n  background-color: rgba(0, 0, 0, 0.025);\n  border-radius: 4px;\n  padding: 0 4px;\n"]))),te=o.input(A||(A=p(["\n  display: block;\n\n  font-family: sans-serif;\n  font-size: 14px;\n  color: rgba(0, 0, 0, 0.4);\n\n  display: block;\n  position: relative;\n\n  width: 100%;\n  height: 32px;\n\n  color: #000;\n\n  margin-left: 8px;\n\n  border: 0;\n  background-color: rgba(0, 0, 0, 0.025);\n  border-radius: 4px;\n  padding: 0 4px;\n"]))),re=t.memo((function(e){var n=e.setValue;return t.createElement(_,{label:e.name},t.createElement(te,{value:e.value,onChange:function(e){return n(e.target.value)}}))})),oe=o.input(j||(j=p(["\n  width: 100%;\n"]))),ie=((N={})[exports.ControlType.NUMBER]=function(e){var r,o=e.name,i=e.value,a=e.setValue,l=e.options,c=n.useRef(null),u=n.useRef(null),s=l.min,d=void 0===s?l.scrub?-Infinity:0:s,p=l.max,f=void 0===p?l.scrub?Infinity:Math.PI:p,b=(null!==(r=l.distance)&&void 0!==r?r:l.scrub)?2:f-d,x=n.useState(l.scrub?150:T(i,d,f,0,300)),m=x[0],g=x[1],v=n.useCallback((function(){l.scrub&&(g(150),u.current=null)}),[l.scrub]);return n.useEffect((function(){var e=c.current;return e&&e.addEventListener("change",v),function(){e&&e.removeEventListener("change",v)}}),[v,c]),t.createElement(_,{label:o,value:(i||0).toFixed(2)},t.createElement(J,{ref:c,type:"range",value:m,min:0,max:300,onChange:function(e){var n=Number(e.target.value);g(n),null===u.current&&(u.current=i);var t=(l.scrub?u.current:0)+T(n-(l.scrub?150:0),0,300,l.scrub?0:d,l.scrub?2*b:f);a(k(t,d,f))}}))},N[exports.ControlType.BOOLEAN]=function(e){var n=e.setValue,r="Control"+e.id;return t.createElement(_,{flexLabel:!0,label:e.name,htmlFor:r},t.createElement(K,{id:r,type:"checkbox",checked:e.value,onChange:function(e){return n(e.currentTarget.checked)}}),t.createElement(W,{htmlFor:r}))},N[exports.ControlType.SELECT]=function(e){var n=e.setValue,r=e.options.items;return t.createElement(_,{label:e.name},t.createElement(ne,{value:e.value,onChange:function(e){return n(e.currentTarget.value)}},(void 0===r?[]:r).map((function(e,n){return t.createElement("option",{key:n},e)}))))},N[exports.ControlType.COLOR]=function(e){var r=e.name,o=e.value,i=e.setValue,a=e.options,l=a.inline,c=void 0!==l&&l,s=a.picker,d=void 0===s?"chrome":s,p=n.useState(!1),f=p[0],b=p[1],x=n.useRef(),m=function(e){"color-picker"!==e.target.id&&x.current&&!x.current.contains(e.target)&&b(!1)};n.useEffect((function(){return document.body.addEventListener("click",m),function(){document.body.removeEventListener("click",m)}}),[]);var g={color:o,onChange:function(e){return i(e.hex)},disableAlpha:a.disableAlpha,colors:a.colors},v=u.ChromePicker;switch(d){case"alpha":v=u.AlphaPicker;break;case"block":v=u.BlockPicker;break;case"circle":v=u.CirclePicker;break;case"compact":v=u.CompactPicker;break;case"github":v=u.GithubPicker;break;case"hue":v=u.HuePicker;break;case"material":v=u.MaterialPicker;break;case"sketch":v=u.SketchPicker,g.presetColors=a.colors;break;case"slider":v=u.SliderPicker;break;case"swatches":v=u.SwatchesPicker;break;case"twitter":v=u.TwitterPicker}return t.createElement(_,{stack:c,label:r,flexLabel:!0},t.createElement(Z,null,c?t.createElement(v,Object.assign({},g,{triangle:c?"hide":void 0,width:268})):t.createElement(t.Fragment,null,t.createElement($,{id:"color-picker",style:{backgroundColor:o},onClick:function(){return b((function(e){return!e}))}}),t.createElement(ee,{hidden:!0!==f,ref:x},t.createElement(v,Object.assign({},g))))))},N[exports.ControlType.STRING]=re,N[exports.ControlType.BUTTON]=function(e){var n=e.options;return t.createElement("div",{style:{paddingTop:8,paddingBottom:8}},t.createElement(Q,{onClick:function(e){n.onClick&&n.onClick(e)}},e.name))},N[exports.ControlType.FILE]=function(e){var n=e.setValue,r=e.options;return t.createElement(_,{label:e.name},t.createElement(oe,{type:"file",onChange:function(e){var t,o=null!==(t=r.loader)&&void 0!==t?t:new c.FileLoader;o.setCrossOrigin&&o.setCrossOrigin("");var i=o.load(URL.createObjectURL(e.currentTarget.files&&e.currentTarget.files[0]));n(i)}}))},N[exports.ControlType.XYPAD]=function(e){var r=e.name,o=e.value,c=e.setValue,u=e.options,s=n.useRef(null),p=u.distance,f=void 0===p?1:p,b=u.scrub,x=void 0!==b&&b,m=l(),g=m[0],v=m[1],h=v.width,y=v.height,E=i.useSpring((function(){return{from:{x:o.x,y:o.y},onChange:function(e,n){var t=k(T(e,0,("x"===n.key?h:y)/2,0,f),-f,f)||0;x||c((function(e){var r;return d({},e,((r={})[n.key]=t<1e-5&&t>-1e-5?0:t,r))}))}}}),[h,y]),w=E[0],C=E[1],O=a.useDrag((function(e){var n=e.down,t=e.movement;n&&!s.current?s.current=o:n||(s.current=null),C({x:n?t[0]:0,y:n?t[1]:0}),x&&(n?c((function(){return{x:s.current.x+T(t[0],0,h/2,0,f),y:s.current.y+T(t[1],0,y/2,0,f)}})):s.current=o)})),L=w.x.to((function(e){return k(e+h/2,0,h)})),R=w.y.to((function(e){return k(e+y/2,0,y)}));return t.createElement(_,{stack:!0,label:r,value:"x: "+o.x.toFixed(1)+", y: "+o.y.toFixed(1)},t.createElement(i.animated.svg,Object.assign({ref:g,style:{userSelect:"none",borderRadius:8,border:"1px solid #f0f0f0"},width:"100%",height:200,xmlns:"http://www.w3.org/2000/svg"},O()),t.createElement("rect",{fill:"rgb(250, 250, 250)",width:"100%",height:"100%"}),t.createElement(i.animated.line,{x1:L,x2:L,y1:0,y2:"100%",stroke:"#ccc"}),t.createElement(i.animated.line,{x1:0,x2:"100%",y1:R,y2:R,stroke:"#ccc"}),t.createElement(i.animated.g,{style:{transform:i.to([L,R],(function(e,n){return"translate("+e+"px, "+n+"px)"}))}},t.createElement("circle",{r:8,fill:"#ccc"}),t.createElement("circle",{r:4,fill:"#aaa"}))))},N),ae=function(e){return t.createElement(_,{label:e.name},'"',e.options.type,'" not found')},le=function(e){var r,o,i,a=e.name,l=e.id,c=e.value,u=e.options,s=n.useContext(f),d=n.useState(s.values.current&&s.values.current.has(l)?s.values.current.get(l):c),p=d[0],b=d[1];n.useEffect((function(){s.values.current.set(l,p)}),[s.values,l,p]),n.useEffect((function(){s.gui.current.set(l,b)}),[s.gui,l]);var x=null!==(r=null!==(o=u.component)&&void 0!==o?o:ie[null!==(i=u.type)&&void 0!==i?i:exports.ControlType.NUMBER])&&void 0!==r?r:ae;return t.createElement(x,{id:l,name:a,value:p,setValue:function(e){var n,t,r,o;null===(n=s.gui.current)||void 0===n||null===(t=n.get(l))||void 0===t||t(e),null===(r=s.state.current)||void 0===r||null===(o=r.get(l))||void 0===o||o(e)},options:u})},ce=o.h2(H||(H=p(["\n  display: block;\n  font-family: sans-serif;\n  font-size: 13px;\n  font-weight: bold;\n  padding-left: 16px;\n  cursor: pointer;\n  position: relative;\n  user-select: none;\n\n  &:before,\n  &:after {\n    content: '';\n    position: absolute;\n    top: 8px;\n    right: 16px;\n    width: 12px;\n    height: 2px;\n    background-color: #333;\n    /* transition: transform 0.25s ease-out; */\n  }\n  &:before {\n    transform: rotate(","deg);\n  }\n\n  &:after {\n    transform: rotate(","deg);\n  }\n"])),(function(e){return e.open?0:90}),(function(e){return e.open?0:180})),ue=o.div(D||(D=p(["\n  background: ",";\n  padding: 16px;\n  display: ",";\n  margin-bottom: 8px;\n"])),(function(e){return e.bg?"#f9f9f9":"#fff"}),(function(e){return e.open?"block":"none"})),se=function(e){var r,o=e.title,i=e.controls,a=e.options,l=n.useState(null===(r=!(void 0===a?{}:a).defaultClosed)||void 0===r||r),c=l[0],u=l[1],s="DEFAULT_GROUP"!==o;return t.createElement("div",null,s&&t.createElement(ce,{open:c,onClick:function(){return u((function(e){return!e}))}},o),t.createElement(ue,{open:c,bg:s},Array.from(i).map((function(e){return t.createElement(le,Object.assign({key:e.id+"_"+e.name},e))}))))},de="@media only screen and (max-width: 600px)";function pe(e){return function(n){return e.includes(n["data-anchor"])?"16px":"auto"}}!function(e){e.TOP_LEFT="top_left",e.TOP_RIGHT="top_right",e.BOTTOM_LEFT="bottom_left",e.BOTTOM_RIGHT="bottom_right"}(Y||(Y={}));var fe=o(i.animated.div)(V||(V=p(["\n  display: flex;\n  flex-direction: column;\n  position: fixed;\n  top: ",";\n  right: ",";\n  bottom: ",";\n  left: ",";\n  width: ","px;\n  border-radius: 16px;\n  background-color: #fff;\n  border-radius: 8px;\n  box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.12);\n\n  "," {\n    transform: none !important;\n    flex-direction: column-reverse;\n    top: auto;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    width: auto;\n  }\n"])),pe([Y.TOP_LEFT,Y.TOP_RIGHT]),pe([Y.BOTTOM_RIGHT,Y.TOP_RIGHT]),pe([Y.BOTTOM_RIGHT,Y.BOTTOM_LEFT]),pe([Y.TOP_LEFT,Y.BOTTOM_LEFT]),(function(e){return e["data-width"]}),de),be=o(i.animated.div)(q||(q=p(["\n  display: flex;\n  align-items: center;\n  position: relative;\n  padding-left: 16px;\n  padding-right: 16px;\n  height: 42px;\n  font-family: sans-serif;\n  font-size: 14px;\n  color: #fff;\n  cursor: move;\n  cursor: grab;\n  user-select: none;\n  background-color: #000;\n  border-top-left-radius: 8px;\n  border-top-right-radius: 8px;\n  border-bottom-left-radius: ","px;\n  border-bottom-right-radius: ","px;\n  box-shadow: 0 0 14px 0 rgba(0, 0, 0, 0.14);\n  "," {\n    border-top-left-radius: 0px;\n    border-top-right-radius: 0px;\n    border-bottom-left-radius: 0px;\n    border-bottom-right-radius: 0px;\n  }\n"])),(function(e){return e["data-collapsed"]?0:8}),(function(e){return e["data-collapsed"]?0:8}),de),xe=o.div(z||(z=p(["\n  width: 30px;\n  height: 18px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: auto;\n  cursor: pointer;\n  &:after {\n    content: '';\n    display: block;\n    height: 3px;\n    width: 16px;\n    background-color: white;\n  }\n  "," {\n    &:before {\n      content: '';\n      display: block;\n      position: absolute;\n      top: 0;\n      right: 0;\n      bottom: 0;\n      left: 0;\n    }\n  }\n"])),de),me=o(i.animated.div)(X||(X=p(["\n  padding-bottom: 8px;\n  overflow-y: auto;\n  max-height: calc(100vh - 42px);\n"]))),ge=function(e){var r=e.title,o=void 0===r?"react-three-gui":r,c=e.defaultClosedGroups,u=void 0===c?[]:c,s=e.width,p=void 0===s?300:s,b=e.style,x=void 0===b?{}:b,m=e.anchor,g=void 0===m?Y.TOP_RIGHT:m,v=n.useContext(f).controls,h=w("REACT_THREE_GUI__COLLAPSED",e.collapsed),y=h[0],E=h[1],T=w("REACT_THREE_GUI__"+g,[0,0]),C=T[0],O=T[1],L=l(),R=L[0],P=L[1],_=i.useSpring((function(){return{pos:C,onRest:function(e){O(e.value)}}})),S=_[0].pos,F=_[1],M=[Y.TOP_LEFT,Y.BOTTOM_LEFT].includes(g),I=[Y.TOP_RIGHT,Y.TOP_LEFT].includes(g),B=a.useDrag((function(e){var n=e.movement,t=e.memo,r=void 0===t?S?S.getValue?S.getValue():S.get():0:t,o=n[0]+r[0],i=n[1]+r[1];return F({pos:[M?k(o,1,window.innerWidth-p-32):k(o,-window.innerWidth+p+32,1),I?k(i,1,window.innerHeight):k(i,-window.innerHeight+P.height+32,1)]}),r})),U=function(e){var n;return{defaultClosed:null!==(n=null==u?void 0:u.includes(e))&&void 0!==n&&n}},G=Array.from(v).reduce((function(e,n){var t,r=(null==n||null===(t=n.options)||void 0===t?void 0:t.group)||"DEFAULT_GROUP";return e[r]=e[r]||[],e[r].push(n),e}),{});return t.createElement(fe,{"data-width":p,"data-anchor":g,ref:R,style:d({},x,{transform:i.to([S],(function(e){return"translate3d("+e[0]+"px,"+e[1]+"px,0)"}))})},t.createElement(be,Object.assign({"data-collapsed":y},B()),o,t.createElement(xe,{collapsed:y,onClick:function(){return E((function(e){return!e}))}})),t.createElement(me,{hidden:!y,style:{maxHeight:I?i.to([S],(function(e){return"calc(100vh - "+(e[1]+92)+"px)"})):void 0}},Object.entries(G).map((function(e){var n=e[0];return t.createElement(se,{key:n,title:n,controls:e[1],options:U(n)})}))))};ge.Provider=function(e){var r=e.children,o=n.useState([]),i=o[0],a=o[1],l=n.useRef(new Map),c=n.useRef(new Map),u=n.useRef(new Map);return t.createElement(f.Provider,{value:{values:l,gui:c,state:u,controls:i,addControl:function(e){return e.id=String(Math.random()),a((function(n){return[].concat(n,[e])})),e},removeControl:function(e){a((function(n){return n.filter((function(n){return n.id!==e.id}))}))}}},r)},ge.Canvas=m,exports.BaseControl=_,exports.Controls=ge,exports.ControlsContext=f,exports.DEFAULT_GROUP="DEFAULT_GROUP",exports.useControl=function(e,t){void 0===t&&(t=E);var r=n.useContext(f),o=n.useState(null),i=o[0],a=o[1],l=n.useState(function(e){if(e.hasOwnProperty("value"))return e.value;switch(e.type){case exports.ControlType.NUMBER:return 0;case exports.ControlType.COLOR:return"#ff0000";case exports.ControlType.STRING:return"";case exports.ControlType.SELECT:return(e.items||[""])[0];case exports.ControlType.BOOLEAN:return!1;case exports.ControlType.FILE:return new c.FileLoader;case exports.ControlType.XYPAD:return{x:0,y:0}}}(t)),u=l[0],d=l[1],p=s.useSpring((function(){return{value:u,config:"object"==typeof t.spring?t.spring:void 0}})),b=p[0],x=p[1],m=function(e){return x({value:e})};return t.state&&(u=t.state[0],d=t.state[1]),n.useEffect((function(){r.state.current&&i&&r.state.current.set(i,t.spring?m:d)}),[r.state,i]),n.useEffect((function(){var n=r.addControl({id:t.id,name:e,value:u,options:t});return a(n.id),function(){r.removeControl(n)}}),[]),n.useEffect((function(){t.spring&&x({value:u}),t.onChange&&t.onChange(u)}),[t,x,u]),t.spring?b.value:u},exports.withControls=b;
//# sourceMappingURL=react-three-gui.cjs.production.min.js.map
